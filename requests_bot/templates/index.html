{% extends "base.html" %}

{% block title %}VMMO Bot - –û–±–∑–æ—Ä{% endblock %}

{% block content %}
{% macro render_bot_card(bot, rank=0) %}
<div class="card bot-card {{ bot.status }}">
    <div class="bot-card-header">
        <div class="bot-name-wrapper">
            {% if rank == 1 %}
            <span class="rank-badge rank-1" title="–¢–æ–ø-1 –ø–æ –¥–æ—Ö–æ–¥—É">ü•á</span>
            {% elif rank == 2 %}
            <span class="rank-badge rank-2" title="–¢–æ–ø-2 –ø–æ –¥–æ—Ö–æ–¥—É">ü•à</span>
            {% elif rank == 3 %}
            <span class="rank-badge rank-3" title="–¢–æ–ø-3 –ø–æ –¥–æ—Ö–æ–¥—É">ü•â</span>
            {% endif %}
            <span class="bot-name">{{ bot.name }}</span>
            {% if bot.is_main %}
            <span class="badge-main">MAIN</span>
            {% endif %}
        </div>
        <span class="status status-{{ bot.status }}">
            <span class="status-dot"></span>
            {{ '–†–ê–ë–û–¢–ê–ï–¢' if bot.status == 'running' else '–°–¢–û–ü' }}
        </span>
    </div>

    {% if bot.activity and bot.activity.activity %}
    <div class="bot-activity">
        {{ bot.activity.activity }}
    </div>
    {% endif %}

    {% if bot.craft and bot.craft.active %}
    <div class="bot-craft">
        <span class="craft-toggle" onclick="toggleCraftChain(event, '{{ bot.profile }}')" style="cursor: pointer;">
            {{ bot.craft.active }}
            {% if bot.craft.chain %}
            <span class="craft-arrow" id="craftArrow-{{ bot.profile }}">‚ñº</span>
            {% endif %}
        </span>
        {% if bot.craft.chain %}
        <div class="craft-chain" id="craftChain-{{ bot.profile }}" style="display: none; margin-top: 0.5rem; padding-left: 0.75rem; font-size: 0.85rem; border-left: 2px solid #444;">
            {% for item in bot.craft.chain %}
            <div style="margin-top: 0.25rem;">
                <span class="text-muted">‚Ä¢</span> {{ item.name }}:
                <span class="{{ 'text-success' if item.have >= item.amount else 'text-danger' }}">{{ item.have }}</span>/<span class="text-gold">{{ item.amount }}</span>
                {% if item.children %}
                <div style="padding-left: 0.75rem; border-left: 1px solid #555;">
                    {% for child in item.children %}
                    <div style="margin-top: 0.15rem;">
                        <span class="text-muted">‚Ä¢</span> {{ child.name }}:
                        <span class="{{ 'text-success' if child.have >= child.amount else 'text-danger' }}">{{ child.have }}</span>/<span class="text-gold">{{ child.amount }}</span>
                        {% if child.children %}
                        <div style="padding-left: 0.75rem; border-left: 1px solid #666;">
                            {% for grandchild in child.children %}
                            <div style="margin-top: 0.15rem;">
                                <span class="text-muted">‚Ä¢</span> {{ grandchild.name }}:
                                <span class="{{ 'text-success' if grandchild.have >= grandchild.amount else 'text-danger' }}">{{ grandchild.have }}</span>/<span class="text-gold">{{ grandchild.amount }}</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endif %}

    <div class="bot-resources">
        <div class="resource-box">
            <img src="{{ url_for('static', filename='icons/money_gold.png') }}" class="res-icon">
            <span class="text-gold">{{ bot.resources.get('–∑–æ–ª–æ—Ç–æ', 0) }}</span>
            {% if bot.earned.get('–∑–æ–ª–æ—Ç–æ', 0) != 0 %}
            <span class="resource-change {{ 'positive' if bot.earned.get('–∑–æ–ª–æ—Ç–æ', 0) > 0 else 'negative' }}">
                {{ '%+d' % bot.earned.get('–∑–æ–ª–æ—Ç–æ', 0) }}
            </span>
            {% endif %}
        </div>
        <div class="resource-box">
            <img src="{{ url_for('static', filename='icons/money_silver.png') }}" class="res-icon">
            <span>{{ bot.resources.get('—Å–µ—Ä–µ–±—Ä–æ', 0) }}</span>
        </div>
        <div class="resource-box">
            <img src="{{ url_for('static', filename='icons/skull.png') }}" class="res-icon">
            <span>{{ bot.resources.get('—á–µ—Ä–µ–ø–∞', 0) }}</span>
        </div>
        <div class="resource-box">
            <img src="{{ url_for('static', filename='icons/mineral.png') }}" class="res-icon">
            <span>{{ bot.resources.get('–º–∏–Ω–µ—Ä–∞–ª—ã', 0) }}</span>
            {% if bot.earned.get('–º–∏–Ω–µ—Ä–∞–ª—ã', 0) != 0 %}
            <span class="resource-change {{ 'positive' if bot.earned.get('–º–∏–Ω–µ—Ä–∞–ª—ã', 0) > 0 else 'negative' }}">
                {{ '%+d' % bot.earned.get('–º–∏–Ω–µ—Ä–∞–ª—ã', 0) }}
            </span>
            {% endif %}
        </div>
        <div class="resource-box">
            <img src="{{ url_for('static', filename='icons/sapphire.png') }}" class="res-icon">
            <span>{{ bot.resources.get('—Å–∞–ø—Ñ–∏—Ä—ã', 0) }}</span>
            {% if bot.earned.get('—Å–∞–ø—Ñ–∏—Ä—ã', 0) != 0 %}
            <span class="resource-change {{ 'positive' if bot.earned.get('—Å–∞–ø—Ñ–∏—Ä—ã', 0) > 0 else 'negative' }}">
                {{ '%+d' % bot.earned.get('—Å–∞–ø—Ñ–∏—Ä—ã', 0) }}
            </span>
            {% endif %}
        </div>
        <div class="resource-box">
            <img src="{{ url_for('static', filename='icons/ruby.png') }}" class="res-icon">
            <span>{{ bot.resources.get('—Ä—É–±–∏–Ω—ã', 0) }}</span>
            {% if bot.earned.get('—Ä—É–±–∏–Ω—ã', 0) != 0 %}
            <span class="resource-change {{ 'positive' if bot.earned.get('—Ä—É–±–∏–Ω—ã', 0) > 0 else 'negative' }}">
                {{ '%+d' % bot.earned.get('—Ä—É–±–∏–Ω—ã', 0) }}
            </span>
            {% endif %}
        </div>
    </div>

    {% if bot.hours > 0 %}
    <div class="text-muted" style="font-size: 0.85rem; margin-top: 0.5rem;">
        –†–∞–±–æ—Ç–∞–µ—Ç: {{ '%.1f' % bot.hours }} —á
    </div>
    {% endif %}

    <div class="bot-actions">
        {% if bot.status == 'running' %}
        <button class="btn btn-sm btn-danger" onclick="stopBot('{{ bot.profile }}')">–°—Ç–æ–ø</button>
        <button class="btn btn-sm btn-warning" onclick="restartBot('{{ bot.profile }}')">–†–µ—Å—Ç–∞—Ä—Ç</button>
        {% else %}
        <button class="btn btn-sm btn-success" onclick="startBot('{{ bot.profile }}')">–°—Ç–∞—Ä—Ç</button>
        {% endif %}
        <a href="/config/{{ bot.profile }}" class="btn btn-sm btn-primary">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
        <a href="/logs/{{ bot.profile }}" class="btn btn-sm btn-ghost">–õ–æ–≥–∏</a>
    </div>
</div>
{% endmacro %}

<div class="flex flex-between flex-center mb-2 flex-wrap gap-1">
    <h1 class="page-title" style="margin: 0;">
        <span class="title-icon">üéÆ</span> –û–±–∑–æ—Ä –±–æ—Ç–æ–≤
    </h1>
    <div class="btn-group">
        <button class="btn btn-secondary" onclick="location.reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        <button class="btn btn-success" onclick="startAll()">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ—Ö</button>
        <button class="btn btn-danger" onclick="stopAll()">‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ—Ö</button>
        <button class="btn btn-warning" onclick="resetAllSkips()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Å–∫–∏–ø—ã</button>
        <button class="btn btn-purple" onclick="sellAllCrafts()">üí∞ –ü—Ä–æ–¥–∞—Ç—å –∫—Ä–∞—Ñ—Ç—ã</button>
    </div>
</div>

<!-- –ú—É–ª—ã - –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–∞—è —Å–µ–∫—Ü–∏—è -->
{% if mules %}
<div class="mules-section">
    <h2 class="section-title">‚õèÔ∏è –ú—É–ª—ã <span class="text-muted">({{ mules_summary.running_count }}/{{ mules_summary.total_count }} —Ä–∞–±–æ—Ç–∞—é—Ç)</span></h2>

    <!-- –°–≤–æ–¥–∫–∞ –ø–æ –º—É–ª–∞–º -->
    <div class="card mules-summary" onclick="toggleMules()">
        <div class="flex flex-between flex-center">
            <div>
                <strong>–í—Å–µ –º—É–ª—ã <span id="mulesArrow">‚ñ≤</span></strong>
                <div class="text-muted" style="font-size: 0.85rem;">–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã —Ä–∞—Å–∫—Ä—ã—Ç—å</div>
            </div>
            <span class="status status-running">
                <span class="status-dot"></span>
                {{ mules_summary.running_count }}/{{ mules_summary.total_count }}
            </span>
        </div>

        <div class="mules-stats mt-1">
            <div class="grid grid-3 gap-1">
                <div class="resource-box">
                    <img src="{{ url_for('static', filename='icons/money_gold.png') }}" class="res-icon">
                    <span class="text-gold">{{ mules_summary.resources.get('–∑–æ–ª–æ—Ç–æ', 0) }}</span>
                    {% if mules_summary.earned.get('–∑–æ–ª–æ—Ç–æ', 0) != 0 %}
                    <span class="resource-change {{ 'positive' if mules_summary.earned.get('–∑–æ–ª–æ—Ç–æ', 0) > 0 else 'negative' }}">
                        {{ '%+d' % mules_summary.earned.get('–∑–æ–ª–æ—Ç–æ', 0) }}
                    </span>
                    {% endif %}
                </div>
                <div class="resource-box">
                    <img src="{{ url_for('static', filename='icons/money_silver.png') }}" class="res-icon">
                    <span>{{ mules_summary.resources.get('—Å–µ—Ä–µ–±—Ä–æ', 0) }}</span>
                </div>
                <div class="resource-box">
                    <img src="{{ url_for('static', filename='icons/skull.png') }}" class="res-icon">
                    <span>{{ mules_summary.resources.get('—á–µ—Ä–µ–ø–∞', 0) }}</span>
                    {% if mules_summary.earned.get('—á–µ—Ä–µ–ø–∞', 0) != 0 %}
                    <span class="resource-change {{ 'positive' if mules_summary.earned.get('—á–µ—Ä–µ–ø–∞', 0) > 0 else 'negative' }}">
                        {{ '%+d' % mules_summary.earned.get('—á–µ—Ä–µ–ø–∞', 0) }}
                    </span>
                    {% endif %}
                </div>
                <div class="resource-box">
                    <img src="{{ url_for('static', filename='icons/mineral.png') }}" class="res-icon">
                    <span>{{ mules_summary.resources.get('–º–∏–Ω–µ—Ä–∞–ª—ã', 0) }}</span>
                    {% if mules_summary.earned.get('–º–∏–Ω–µ—Ä–∞–ª—ã', 0) != 0 %}
                    <span class="resource-change {{ 'positive' if mules_summary.earned.get('–º–∏–Ω–µ—Ä–∞–ª—ã', 0) > 0 else 'negative' }}">
                        {{ '%+d' % mules_summary.earned.get('–º–∏–Ω–µ—Ä–∞–ª—ã', 0) }}
                    </span>
                    {% endif %}
                </div>
                <div class="resource-box">
                    <img src="{{ url_for('static', filename='icons/sapphire.png') }}" class="res-icon">
                    <span>{{ mules_summary.resources.get('—Å–∞–ø—Ñ–∏—Ä—ã', 0) }}</span>
                    {% if mules_summary.earned.get('—Å–∞–ø—Ñ–∏—Ä—ã', 0) != 0 %}
                    <span class="resource-change {{ 'positive' if mules_summary.earned.get('—Å–∞–ø—Ñ–∏—Ä—ã', 0) > 0 else 'negative' }}">
                        {{ '%+d' % mules_summary.earned.get('—Å–∞–ø—Ñ–∏—Ä—ã', 0) }}
                    </span>
                    {% endif %}
                </div>
                <div class="resource-box">
                    <img src="{{ url_for('static', filename='icons/ruby.png') }}" class="res-icon">
                    <span>{{ mules_summary.resources.get('—Ä—É–±–∏–Ω—ã', 0) }}</span>
                    {% if mules_summary.earned.get('—Ä—É–±–∏–Ω—ã', 0) != 0 %}
                    <span class="resource-change {{ 'positive' if mules_summary.earned.get('—Ä—É–±–∏–Ω—ã', 0) > 0 else 'negative' }}">
                        {{ '%+d' % mules_summary.earned.get('—Ä—É–±–∏–Ω—ã', 0) }}
                    </span>
                    {% endif %}
                </div>
            </div>

            {% if mules_summary.total_hours > 0 and mules_summary.running_count > 0 %}
            {% set avg_hours = mules_summary.total_hours / mules_summary.running_count %}
            <div class="mules-stats-footer">
                <div class="stat-item">
                    <span class="stat-label">‚è±Ô∏è –í—Ä–µ–º—è</span>
                    <span class="stat-value">~{{ '%.1f' % avg_hours }} —á</span>
                </div>
                {% if mules_summary.earned.get('–∑–æ–ª–æ—Ç–æ', 0) and avg_hours > 0 %}
                <div class="stat-item">
                    <span class="stat-label">üìà –°–∫–æ—Ä–æ—Å—Ç—å</span>
                    <span class="stat-value text-gold">{{ '%.1f' % (mules_summary.earned.get('–∑–æ–ª–æ—Ç–æ', 0) / avg_hours) }} –∑/—á</span>
                </div>
                {% endif %}
                {% if best_mule %}
                <div class="stat-item champion">
                    <span class="champion-badge">{{ best_mule.name }}</span>
                    <span class="stat-value text-gold">+{{ best_mule.earned.get('–∑–æ–ª–æ—Ç–æ', 0) }}g</span>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –º—É–ª–æ–≤ -->
    <div id="mulesGrid" class="grid grid-3 mt-1" style="display: none;">
        {% for bot in mules %}
        {# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–Ω–≥ –ø–æ –¥–æ—Ö–æ–¥—É –∑–æ–ª–æ—Ç–∞ #}
        {% set gold_earned = bot.earned.get('–∑–æ–ª–æ—Ç–æ', 0) %}
        {% set rank = 0 %}
        {% if best_mule and bot.name == best_mule.name %}
            {% set rank = 1 %}
        {% elif mules_sorted and mules_sorted|length > 1 and bot.name == mules_sorted[1].name %}
            {% set rank = 2 %}
        {% elif mules_sorted and mules_sorted|length > 2 and bot.name == mules_sorted[2].name %}
            {% set rank = 3 %}
        {% endif %}
        {{ render_bot_card(bot, rank) }}
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- –ú–µ–π–Ω—ã -->
{% if mains %}
<h2 class="section-title mt-2">‚öîÔ∏è –ú–µ–π–Ω—ã</h2>
<div class="grid grid-3">
    {% for bot in mains %}
    {{ render_bot_card(bot) }}
    {% endfor %}
</div>
{% endif %}

<!-- –ï—Å–ª–∏ –Ω–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö -->
{% if not mains and not mules %}
<div class="grid grid-3">
    {% for bot in stats %}
    {{ render_bot_card(bot) }}
    {% endfor %}
</div>
{% endif %}

<!-- Telegram –±–æ—Ç -->
<div class="tg-bot-section mt-2">
    <div class="card">
        <div class="flex flex-between flex-center">
            <div>
                <strong>Telegram –±–æ—Ç</strong>
                <span id="tgStatus" class="status status-stopped">
                    <span class="status-dot"></span>
                    <span id="tgStatusText">...</span>
                </span>
            </div>
            <div class="btn-group">
                <button class="btn btn-sm btn-success" onclick="tgAction('start')">–°—Ç–∞—Ä—Ç</button>
                <button class="btn btn-sm btn-danger" onclick="tgAction('stop')">–°—Ç–æ–ø</button>
                <button class="btn btn-sm btn-warning" onclick="tgAction('restart')">–†–µ—Å—Ç–∞—Ä—Ç</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<style>
    .section-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 0.75rem;
    }

    .mules-summary {
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .mules-summary:hover {
        border-color: var(--accent);
    }

    .res-icon {
        width: 18px;
        height: 18px;
    }

    .res-icon-sm {
        width: 14px;
        height: 14px;
        vertical-align: middle;
    }

    .resource-box {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.4rem 0.6rem;
        background: var(--glass);
        border: 1px solid var(--glass-border);
        border-radius: 8px;
        font-size: 0.9rem;
    }

    .resource-box .resource-change {
        margin-left: 0;
    }

    .bot-name-wrapper {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .bot-name-wrapper .rank-badge {
        font-size: 1.125rem;
        background: none;
        box-shadow: none;
        width: auto;
        height: auto;
    }

    .badge-main {
        display: inline-block;
        padding: 0.15rem 0.4rem;
        background: var(--warning);
        color: #000;
        font-size: 0.65rem;
        font-weight: 700;
        border-radius: 4px;
        margin-left: 0.5rem;
        vertical-align: middle;
    }

    /* Running bot card glow effect */
    .bot-card.running {
        border-left: 3px solid var(--success);
    }

    .bot-card.stopped {
        opacity: 0.75;
    }

    .bot-card.running:hover {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 20px var(--success-glow);
    }

    .bot-activity {
        font-size: 0.85rem;
        padding: 0.5rem 0.75rem;
        background: var(--warning-bg);
        border-left: 3px solid var(--warning);
        border-radius: 0 8px 8px 0;
        margin: 0.75rem 0;
        color: var(--warning);
    }

    .bot-craft {
        font-size: 0.85rem;
        padding: 0.5rem 0.75rem;
        background: var(--accent-bg);
        border-left: 3px solid var(--accent);
        border-radius: 0 8px 8px 0;
        margin: 0.75rem 0;
        color: var(--accent-light);
    }

    .bot-resources {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
        margin: 0.75rem 0;
    }

    .btn-purple {
        background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
        color: white;
        box-shadow: 0 2px 12px rgba(168, 85, 247, 0.4);
    }

    .btn-purple:hover {
        box-shadow: 0 4px 20px rgba(168, 85, 247, 0.5);
        transform: translateY(-1px);
    }

    @media (max-width: 768px) {
        .bot-resources {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .tg-bot-section .card {
        padding: 1rem 1.25rem;
    }
</style>

<script>
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥—Ä–æ–ø–¥–∞—É–Ω–∞ –∏–∑ localStorage
    let mulesExpanded = localStorage.getItem('mulesExpanded') === 'true';

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
        const grid = document.getElementById('mulesGrid');
        const arrow = document.getElementById('mulesArrow');
        if (grid && arrow && mulesExpanded) {
            grid.style.display = 'grid';
            arrow.textContent = '‚ñº';
        }
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å TG –±–æ—Ç–∞
        checkTgStatus();
    });

    function toggleMules() {
        mulesExpanded = !mulesExpanded;
        localStorage.setItem('mulesExpanded', mulesExpanded);

        const grid = document.getElementById('mulesGrid');
        const arrow = document.getElementById('mulesArrow');

        if (mulesExpanded) {
            grid.style.display = 'grid';
            arrow.textContent = '‚ñº';
        } else {
            grid.style.display = 'none';
            arrow.textContent = '‚ñ≤';
        }
    }

    function toggleCraftChain(event, profile) {
        event.stopPropagation();
        const chain = document.getElementById('craftChain-' + profile);
        const arrow = document.getElementById('craftArrow-' + profile);
        if (!chain) return;

        if (chain.style.display === 'none') {
            chain.style.display = 'block';
            if (arrow) arrow.textContent = '‚ñ≤';
        } else {
            chain.style.display = 'none';
            if (arrow) arrow.textContent = '‚ñº';
        }
    }

    async function resetAllSkips() {
        if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Å–∫–∏–ø—ã –¥–∞–Ω–∂–µ–π?')) return;
        const result = await apiCall('/api/reset_skips', 'POST');
        showToast(result.success ? '–°–∫–∏–ø—ã —Å–±—Ä–æ—à–µ–Ω—ã!' : '–û—à–∏–±–∫–∞', result.success ? 'success' : 'error');
    }

    async function sellAllCrafts() {
        if (!confirm('–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ –∫—Ä–∞—Ñ—Ç—ã?')) return;
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = '–ü—Ä–æ–¥–∞—é...';

        try {
            const result = await apiCall('/api/sell_crafts', 'POST');
            showToast(result.success ? '–ö—Ä–∞—Ñ—Ç—ã –ø—Ä–æ–¥–∞–Ω—ã!' : '–û—à–∏–±–∫–∞', result.success ? 'success' : 'error');
        } finally {
            btn.disabled = false;
            btn.textContent = '–ü—Ä–æ–¥–∞—Ç—å –∫—Ä–∞—Ñ—Ç—ã';
        }
    }

    // TG –±–æ—Ç
    async function checkTgStatus() {
        try {
            const result = await apiCall('/api/telegram_bot/status');
            const statusEl = document.getElementById('tgStatus');
            const textEl = document.getElementById('tgStatusText');
            if (result.running) {
                statusEl.className = 'status status-running';
                textEl.textContent = '–†–ê–ë–û–¢–ê–ï–¢';
            } else {
                statusEl.className = 'status status-stopped';
                textEl.textContent = '–°–¢–û–ü';
            }
        } catch (e) {
            console.error('TG status error:', e);
        }
    }

    async function tgAction(action) {
        const result = await apiCall(`/api/telegram_bot/${action}`, 'POST');
        showToast(result.success ? `TG –±–æ—Ç: ${action}` : '–û—à–∏–±–∫–∞', result.success ? 'success' : 'error');
        setTimeout(checkTgStatus, 2000);
    }
</script>
{% endblock %}
